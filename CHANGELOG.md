# Changelog

All notable changes to this project are documented in this file.

## v0.3.4 - 2026-02-21
- Fixed CI clean-checkout bootstrap ordering in `.github/workflows/ci.yml` by adding an explicit `npm run sde:prepare` step before `check:artifact-consistency` and hermetic build, and added regression coverage in `scripts/tests/repository-artifact-hygiene.test.mjs` to enforce the bootstrap/consistency/build sequence.
- Corrected zKill foreground refresh abort/dedupe regression coverage in `src/lib/api/zkill.test.ts` by replacing a timing-dependent cross-signal assertion with controlled in-flight request checks that explicitly enforce same-signal dedupe (`1` call) and different-signal abort isolation (`2` calls), and documented the dedupe boundary inline in `src/lib/api/zkill.ts`.
- Fixed zKill character danger parsing boundary in `src/lib/api/zkill/parsing.ts` so `dangerRatio: 1` now remains `1%` (instead of being mis-normalized to `100%`), and added a regression test in `src/lib/api/zkill.test.ts`.
- Fixed duplicate paste ingestion in `src/lib/usePasteInputIntegration.ts` by deduplicating the same native paste event across the paste-trap `onPaste` and global window listener paths, and added regression coverage in `src/lib/usePasteInputIntegration.test.tsx` that forces one bubbled trap paste to hit both listeners while still asserting a single `applyPaste` invocation.
- Consolidated manual-entry, paste-input, and app-preferences hook behavior into feature-level modules (`src/lib/useManualEntryHandlers.ts`, `src/lib/usePasteInputIntegration.ts`, `src/lib/useAppPreferences.ts`), removed deprecated thin wrapper hooks/tests, and added callback-stability/persistence regression coverage in `src/lib/useManualEntryHandlers.test.tsx`, `src/lib/usePasteInputIntegration.test.tsx`, and `src/lib/useAppPreferences.test.tsx` while preserving app-level paste/manual-entry UX (`src/App.paste.integration.test.tsx`).
- Refactored `usePilotIntelPipelineEffect` orchestration into focused boundaries for pilot identity/entry signatures (`src/lib/pipeline/pilotIdentity.ts`), roster diffing (`src/lib/pipeline/rosterDiff.ts`), run lifecycle (`src/lib/pipeline/runLifecycle.ts`), and background refresh scheduling (`src/lib/pipeline/backgroundRefresh.ts`), while preserving roster refresh and paste-flow behavior.
- Moved JSX render helpers out of `src/lib/ui.tsx` into component-aligned modules (`src/components/shipPillRender.tsx`, `src/components/pilotCardResistRender.tsx`) and moved updater-status formatting to `src/lib/presentation.ts`, leaving `src/lib/ui.tsx` focused on tank-inference logic.
- Decomposed large pilot/fleet render surfaces by extracting `src/components/pilotCardSubviews.tsx` and `src/components/fleetSummarySubviews.tsx`, turning `PilotCardView` and `FleetSummary` into thin coordinator shells with explicit subview props and preserving existing layout/snapshot behavior.
- Added a boundary regression in `src/lib/ui.test.tsx` that fails when render/updater helper exports are reintroduced to `src/lib/ui.tsx`.
- Fixed an orchestration gap where entry-signature changes could be dropped while a pilot run was already active by queueing a follow-up run and starting it immediately after the active run settles; added regression coverage in `src/lib/usePilotIntelPipelineEffect.test.tsx` and lifecycle unit coverage in `src/lib/pipeline/runLifecycle.test.ts`.
- Consolidated duplicated script CLI parsing/error helpers into shared utilities in `scripts/lib/cli-utils.mjs`, and migrated `dogma-parity-new-fits`, `dogma-parity-followup-baseline`, and `fetch-zkill-fits` CLIs to the shared argv validation, option-value parsing, usage-output, and runtime-error formatting paths without changing public flags.
- Added hermetic prebuild hardening via `scripts/prebuild-sde.mjs` with `EVE_HERMETIC_BUILD=1` support, allowing `npm run build` to skip network-dependent `sde:sync` and compile from local SDE artifacts while keeping default prebuild behavior unchanged.
- Added fail-fast SDE compile guardrails in `scripts/compile-dogma-pack.mjs` to reject placeholder/missing manifest hashes and empty/malformed required CSV inputs before writing dogma artifacts; added regression coverage in `scripts/tests/repository-artifact-hygiene.test.mjs`.
- Hardened SDE artifact input integrity by recording `syncState` completeness metadata in `scripts/sync-sde.mjs` and failing `scripts/compile-dogma-pack.mjs` when manifest state is `partial`/non-complete, with regression coverage in `scripts/tests/repository-artifact-hygiene.test.mjs`.
- Added a regression gate in `scripts/tests/fetch-zkill-fits.args.test.mjs` to enforce explicit non-array argv rejection for script CLI parsing (`CLI arguments must be provided as an array.`), aligning zKill parser behavior with parity CLI contracts.
- Added Dogma artifact retention policy wiring in `scripts/compile-dogma-pack.mjs` with hash-verified archive safety checks, so runtime `public/data` now keeps only the active pack while historical packs move to `data/sde/artifacts/dogma-packs`; added retention index output at `data/sde/artifacts/dogma-pack-retention.json`.
- Added retention/manifest compatibility regression coverage in `scripts/tests/repository-artifact-hygiene.test.mjs` plus shared policy helpers in `scripts/lib/dogma-artifact-policy.mjs`, and extended `DogmaManifest` typing with optional retention metadata fields in `src/lib/dogma/types.ts`.
- Added deterministic local artifact consistency checks via `npm run check:artifact-consistency` (`scripts/check-artifact-consistency.mjs` + `scripts/lib/dogma-artifact-consistency.mjs`) to validate manifest/runtime hash coherence, runtime-pack boundary, and retention-index/archive consistency; added pass/fail regression coverage in `scripts/tests/repository-artifact-hygiene.test.mjs` and documented usage in `README.md`.
- Enforced artifact-consistency validation in CI by adding `npm run check:artifact-consistency` to `.github/workflows/ci.yml` `validate` job between `npm test` and `npm run build`, so artifact drift now fails the pipeline before production build.
- Enforced hermetic build policy in CI by requiring `EVE_HERMETIC_BUILD=1` for the validate job build step in `.github/workflows/ci.yml`, and extended `scripts/tests/repository-artifact-hygiene.test.mjs` to fail when hermetic enforcement is missing.
- Extracted shared pilot-domain contracts into `src/lib/pilotDomain.ts` and moved `PilotCard` ownership out of `src/lib/usePilotIntelPipeline.ts`, then rewired type imports across hooks/components/pipeline modules without changing runtime behavior.
- Added a boundary regression guard in `src/lib/pilotDomain.boundary.test.ts` that fails when `PilotCard` is imported from `usePilotIntelPipeline`, preventing hook-boundary type leakage from reappearing.
- Hardened `src/lib/pilotDomain.boundary.test.ts` import-boundary detection by replacing the narrow regex with AST-based import analysis and adding regression coverage for equivalent `PilotCard` import syntax variants (`import type { ... }`, inline `import { type ... }`, and alias forms) from `usePilotIntelPipeline`.
- Closed remaining `PilotCard` boundary detector bypasses in `src/lib/pilotDomain.boundary.test.ts` by flagging named value imports and namespace type-alias usage (`import type * as Alias ... Alias.PilotCard`) from `usePilotIntelPipeline`.
- Completed final `PilotCard` boundary hardening in `src/lib/pilotDomain.boundary.test.ts` by detecting `import("./usePilotIntelPipeline").PilotCard` type-query usage and adding regression coverage for that bypass form.
- Hardened `PilotCard` boundary enforcement in `src/lib/pilotDomain.boundary.test.ts` by detecting indexed-access `import()` type queries (`import("./usePilotIntelPipeline")["PilotCard"]`) and adding regression coverage for that bypass form.
- Closed adjacent `PilotCard` import-type boundary bypasses in `src/lib/pilotDomain.boundary.test.ts` by detecting parenthesized indexed-access forms (`(import("./usePilotIntelPipeline"))["PilotCard"]`) and template-literal indexed forms (`import("./usePilotIntelPipeline")[\`PilotCard\`]`) from `usePilotIntelPipeline`.
- Refactored `src/lib/api/zkill.ts` into a stable coordinator over new focused modules (`src/lib/api/zkill/transport.ts`, `src/lib/api/zkill/cachePolicy.ts`, `src/lib/api/zkill/hydration.ts`, `src/lib/api/zkill/parsing.ts`, `src/lib/api/zkill/types.ts`, `src/lib/api/zkill/constants.ts`), preserving the public API contract while reducing coupling between transport/cache/hydration/parsing responsibilities.
- Added zKill degraded-path regression coverage in `src/lib/api/zkill.cachePolicy.test.ts` and `src/lib/api/zkill.test.ts`, including a 304 revalidation guard that keeps repaired normalized cached rows from being re-poisoned and a hydration-failure fallback guard that preserves normalized list rows.
- Decomposed phase-1 Dogma defense math from `src/lib/dogma/calc.ts` into `src/lib/dogma/rules/defenseMath.ts` (HP/resistance helper logic plus resist/EHP post-processing), added characterization coverage in `src/lib/dogma/rules/defenseMath.test.ts`, and kept parity gates green (`src/lib/dogma/calc.test.ts` + parity follow-up suites + `dogma:parity:check`).
- Converged pipeline runtime-path handling by delegating `processPilotEntry` (`src/lib/pipeline/pilotProcessor.ts`) to the production breadth pipeline path (`runBreadthPilotPipeline`), reducing parallel stage-flow ambiguity while preserving the single-pilot processing contract.
- Hardened paged history error handling in `src/lib/pipeline/breadthPipeline.ts` so per-pilot page-fetch failures now produce explicit error cards and stop only the failed pilot from further rounds instead of being silently swallowed.
- Added regression coverage for the page-fetch rejection path and runtime-path delegation behavior in `src/lib/pipeline/breadthPipeline.test.ts` and `src/lib/pipeline/pilotProcessor.test.ts`.
- Hardened breadth recompute-worker failure handling in `src/lib/pipeline/breadthPipeline.ts` so per-pilot recompute exceptions now emit deterministic pilot error cards plus debug telemetry (`Pilot recompute failed`) instead of being dropped by worker-settled promises; added regression coverage in `src/lib/pipeline/breadthPipeline.test.ts`.
- Added Tech I industrial haulers (including `Sigil`) to the cyno-capable hull whitelist in `src/lib/cyno.ts` so `Cyno` can render when same-hull losses contain industrial cyno module evidence, and added regression coverage in `src/lib/cyno.test.ts`.
- Updated `estimateShipCynoChance` in `src/lib/cyno.ts` to treat same-ship-type fitted cyno evidence as a hard override (`cynoCapable: true`, `cynoChance: 100`) even for non-whitelisted hulls, with `shipTypeId`-first matching and name fallback only when `shipTypeId` is missing; also constrained cyno scoring evidence to fitted-slot modules only (cargo flags excluded) and added regression coverage in `src/lib/cyno.test.ts`.
- Switched cache namespacing in `src/lib/cache/types.ts` from static `v4` to app-version-derived (`app-${import.meta.env.PACKAGE_VERSION}`), so upgrading the app automatically starts from a fresh cache namespace; added namespace coverage in `src/lib/cache/localStore.test.ts`.
- Expanded `Bait` evidence propagation in `src/lib/cyno.ts` from same-ship matching to pilot-wide non-combat bait killmail evidence: when a pilot has a qualifying non-solo/non-pod kill while flying a whitelisted non-combat bait hull (for example `Occator`), the selected bait evidence now applies to all predicted whitelisted non-combat bait ships (for example `Impel`), with regression coverage in `src/lib/cyno.test.ts`.
- Switched `Bait` pill visibility to evidence-first in `src/lib/presentation.ts` so valid `pillEvidence.Bait` now renders regardless of ship probability or `jumpAssociation` score (while still suppressing pod/capsule ships), updated bait tooltip copy in `src/lib/ui.tsx` to reflect killmail-backed evidence, and added regressions in `src/lib/presentation.test.ts` and `src/lib/ui.test.tsx` for low-probability/non-jump-association evidence-backed bait rendering.
- Updated fleet summary cyno row highlighting in `src/styles.css` so `.fleet-summary-line.cyno-highlight` uses full-row tinting (instead of the partial fade used for ship-list rows), eliminating the visible uncolored strip and coloring the full fleet-summary row when cyno is highlighted.
- Removed `gap` spacing from `.fleet-summary-list` in `src/styles.css` so highlighted fleet rows render their background flush to each row's separator line (`border-bottom`) instead of leaving an uncolored inter-row strip.
- Normalized Fleet Summary row highlight height in `src/styles.css` by applying consistent vertical padding to all `.fleet-summary-line` rows and no longer removing bottom padding on `:last-child`, so highlighted top/bottom rows render with matching height while still dropping only the final divider border.
- Aligned combat-capability damage coloring to pyfa/EVE resistance palette in `src/styles.css` using shared damage color variables (`EM/Thermal/Kinetic/Explosive`) across both DPS split labels and resist table cells, and fixed primary tank-row highlighting so it no longer overrides per-damage text/bar colorization.
- Added resistance-profile header damage icons above the resist columns in `src/components/PilotCardView.tsx`, rendered from bundled local pyfa assets in `public/icons/damage`.
- Added leading combat icons in `src/components/PilotCardView.tsx`: DPS now uses the exact Dogma-simulated primary DPS source `typeId` icon (`images.evetech.net/types/{typeId}/icon`) and Speed shows an AB/MWD propulsion icon before the speed range value via ESI type icons.
- Extended Dogma output metadata in `src/lib/dogma/types.ts` and `src/lib/dogma/calc.ts` with optional `primaryDpsGroup` and `propulsionKind` display signals so UI icon rendering follows modeled combat and propulsion behavior.
- Added regression coverage for the above behavior in `src/lib/dogma/calc.test.ts`, `src/components/PilotCardView.test.tsx`, `src/styles.combatCapability.test.ts`, and `src/assets.combatIcons.test.ts`.

Boundary source:
- Previous boundary marker commit `2efc572` (`v0.3.3`) used as lower boundary because no `v0.3.4` tag exists yet.
- Summarized from history in range `2efc572..HEAD` plus current workspace changes.

## v0.3.1 - 2026-02-20
- Rounded ship likelihood percentage display to whole numbers in `src/components/PilotCardView.tsx` and `src/components/FleetSummary.tsx`, while preserving underlying `predictedShips.probability` precision and leaving EFT fit-confidence formatting unchanged.
- Added ship-likelihood rounding coverage in `src/components/PilotCardView.test.tsx`, `src/components/FleetSummary.test.tsx`, and `src/lib/presentation.test.ts` via a shared formatter in `src/lib/presentation.ts`.

Boundary source:
- Previous boundary marker commit `ecfb03e` (`v0.3.0`) used as lower boundary because no `v0.3.1` tag exists yet.
- Summarized from history in range `ecfb03e..HEAD`.

## v0.3.0 - 2026-02-18
- Improved ID-first shield drift resilience for deferred shield-resistance-amplifier candidates by adding `effectId=2052` (`modifyShieldResonancePostPercent`) as a minor shield signal in `src/lib/tank/classifier.ts`; added a focused regression in `src/lib/tank/classifier.test.ts` proving `groupId=295` amplifier modules (`1808`, `2537`) now contribute shield score without forcing classification, preserving ambiguity/near-tie `null` behavior.
- Expanded ID-first shield-local drift resilience for unresolved `Shield Power Relay` family TypeIds seen in fresh corpus usage by adding a narrow local shield major ID signal (`groupId=57` with `effectId=5461`) in `src/lib/tank/classifier.ts`; extended curated fixture guards in `src/lib/tank/classifier.test.ts` for `1422` (`Shield Power Relay II`) and `37820` (`Caldari Navy Shield Power Relay`), and added an explicit remote-logi negative guard for `3586` (`Small Remote Shield Booster I`) to preserve `null` outcomes for remote shield boosters.
- Expanded ID-first shield-local drift resilience for unresolved shield extender families seen in real corpus usage by adding a narrow local shield major signal (`groupId=38`) in `src/lib/tank/classifier.ts`; extended curated fixture guards in `src/lib/tank/classifier.test.ts` for `3831` (`Medium Shield Extender II`), `3841` (`Large Shield Extender II`), and `8517` (`Medium F-S9 Regolith Compact Shield Extender`), and added an explicit remote-logi negative guard for `3588` (`Small Remote Shield Booster II`) to preserve `null` outcomes for remote shield boosters.
- Expanded shield-local drift resilience for unresolved `Shield Boost Amplifier` family TypeIds seen in corpus usage by adding a narrow local major ID signal (`groupId=338` with boost-amplifier effects `1720/3061`) in `src/lib/tank/classifier.ts`; extended curated fixture guards in `src/lib/tank/classifier.test.ts` for `24443` (`Shield Boost Amplifier II`), `14047` (`Dread Guristas Shield Boost Amplifier`), and `19297` (`Gist C-Type Shield Boost Amplifier`), while adding explicit remote-logi negatives (`3598`, `3616`) to preserve `null` outcomes for remote shield boosters.
- Expanded tank-classifier drift resilience for additional unresolved hull and shield candidates seen in corpus-aligned module families by adding hull bulkhead TypeId anchors (`5647`, `5649`) and a narrow local shield-booster ID signal (`groupId=40` with `effectId=3201`) in `src/lib/tank/classifier.ts`; extended curated fixture guards in `src/lib/tank/classifier.test.ts` for `Type-D Restrained Reinforced Bulkheads` (`5647`), `Mark I Compact Reinforced Bulkheads` (`5649`), and `Large Shield Booster II` (`10858`), while preserving ambiguity/tie-to-`null` behavior and preventing remote shield booster over-classification.
- Improved tank-classifier drift resilience for unresolved armor/hull TypeIds seen in corpus usage by promoting armor plate major-effect coverage (`2837`, armor HP bonus) and adding explicit hull bulkhead TypeId anchors (`1333`, `34485`, `34487`) in `src/lib/tank/classifier.ts`; expanded curated fixture guards in `src/lib/tank/classifier.test.ts` for `20353` (`1600mm Steel Plates II`) and hull bulkhead variants while preserving existing confidence/margin null-on-ambiguity behavior.
- Expanded tank-classifier drift resilience for additional high-confidence armor/hull ID-path candidates by promoting armor local-repair and armor-rig effects (`27`, `2792`) and adding a reinforced-bulkhead hull type anchor (`1335`) in `src/lib/tank/classifier.ts`, with new curated fixture guards in `src/lib/tank/classifier.test.ts` for `3530` (`Medium Armor Repairer II`), `31015` (`Small Explosive Armor Reinforcer II`), and `1335` (`Reinforced Bulkheads II`) while preserving existing confidence/margin tie-to-null behavior.
- Expanded tank-classifier drift resilience for ID-first inference by adding shield-rig major-effect coverage (`2795`, `486`, `4967`) in `src/lib/tank/classifier.ts` and extending curated TypeId drift guards in `src/lib/tank/classifier.test.ts` for real-world unresolved candidates (`31724`, `31812`, `31822`), while preserving existing confidence/margin tie-to-null behavior.
- Migrated resist-row tank inference to a canonical ID-driven classifier in `src/lib/tank/classifier.ts` (TypeId/GroupId/EffectId scoring for shield/armor/hull) and added focused classifier coverage in `src/lib/tank/classifier.test.ts`.
- Enriched inferred fit modules with optional Dogma metadata (`groupId`, `categoryId`, `effectIds`) via `src/lib/intel/fitDogmaEnrichment.ts`, updated `FitResolvedModule` in `src/lib/dogma/types.ts`, and threaded optional `dogmaIndex` through fit derivation/pipeline recompute paths.
- Switched `inferTankTypeFromFit` in `src/lib/ui.tsx` to ID-first precedence with regex fallback only when ID metadata is unavailable, preserving existing confidence and near-tie `null` behavior; added precedence regression tests in `src/lib/ui.test.tsx`.
- Added drift guards and diagnostics for tank inference: curated typeId fixture assertions, unknown tank-like candidate surfacing, and runtime fallback/no-signal diagnostics with regression coverage in `src/lib/tank/classifier.test.ts` and `src/lib/ui.test.tsx`.
- Expanded tank-type inference coverage in `src/lib/ui.tsx` so single strong local tank modules now classify correctly across shield/armor/hull paths (including ancillary shield boosters such as `X-Large Ancillary Shield Booster`, local armor/hull repairers, and core tank rigs like `Core Defense ...`/`Auxiliary Nano Pump`/`Nanobot Accelerator`); added regression coverage in `src/lib/ui.test.tsx`.
- Added tank-type highlighting for ship resist profiles by inferring shield/armor/hull tanking from fitted extenders, plates, hull reinforcers, rigs, and repairers (`src/lib/ui.tsx`), then marking the detected resist row in `src/components/PilotCardView.tsx` while keeping `S/A/H` labels; added regression coverage in `src/lib/ui.test.tsx` and `src/components/PilotCardView.test.tsx`.
- Refined tank inference source precedence in `src/lib/ui.tsx` so resolved module names from `modulesBySlot` are used first and `eftSections` are only a fallback when resolved names are unavailable, preventing conflicting cross-source double counting; added regression coverage in `src/lib/ui.test.tsx`.
- Added tank-inference confidence gating in `src/lib/ui.tsx` with centralized minimum-score and top-vs-runner-up margin thresholds, so weak or near-tied fits now resolve to unknown while strong dominant fits still classify; added regression coverage in `src/lib/ui.test.tsx`.
- Added Step 3 dogma-aware tank classification in `src/lib/ui.tsx` by scoring module effect metadata (`effects`/`effectsMeta`) ahead of name heuristics for ambiguous module names while preserving existing source precedence and confidence/margin gates; added regression coverage in `src/lib/ui.test.tsx`.
- Added Step 4 impact-weighted tank scoring in `src/lib/ui.tsx` by introducing deterministic defensive contribution tiers (`major`/`medium`/`minor`) across both metadata and EFT-name fallback paths, and by scoring fallback names per module contribution rather than single-pass max matches; preserved existing source precedence and confidence/margin tie gating, with new regression coverage in `src/lib/ui.test.tsx`.
- Completed Step 5 tank-inference corpus expansion by adding six deterministic parity fixtures to `data/parity/fit-corpus.jsonl` (dominant shield/armor/hull, mixed near-tie null, metadata-first, and EFT-fallback cases) plus corpus-driven regression coverage in `src/lib/ui.test.tsx` that validates per-fit expected outcomes without changing existing inference behavior.
- Updated the resist-profile detected-tank row highlight in `src/styles.css` to use a flat red background (no gradient) while keeping existing cyno gradient highlights unchanged elsewhere.
- Refined the detected-tank resist-row emphasis in `src/styles.css` by removing added row border framing and keeping the brighter red fill/text-only highlight treatment.
- Tightened `Bait` evidence collection in `src/lib/cyno.ts` to require cyno-capable non-combat hulls (hauler/BR/DST/venture-family list, including `Viator`/`Deluge`) and non-solo matched-ship killmails (using character-attacker count plus zKill `solo` when available), preventing combat-hull and solo/structure-assisted false positives; added regression coverage in `src/lib/cyno.test.ts`.
- Refined killmail-backed `Bait` evidence eligibility in `src/lib/cyno.ts` to ignore solo killmails and pod/capsule victims, preventing false-positive `Bait` pills from single-attacker pod kills; added regression coverage in `src/lib/cyno.test.ts` and updated `src/__snapshots__/App.layout.snapshot.test.tsx.snap`.
- Changed `Bait` pill evidence selection in `src/lib/cyno.ts` to be killmail-only (matched attacker ship on character kills) instead of loss-module-derived, while keeping `Cyno` evidence loss-module-derived; added regression coverage in `src/lib/cyno.test.ts` and updated `src/__snapshots__/App.layout.snapshot.test.tsx.snap` so `Bait` links point to killmail evidence.
- Expanded shared HTTP retry classification to treat zKill-style `420` responses as rate-limit/retryable (alongside `429`/`5xx`) in `src/lib/api/http.ts`, and added regression coverage in `src/lib/api/http.test.ts` to verify successful retry/backoff behavior after an initial `420`.
- Reduced per-pilot zKill page fan-out backpressure in `src/lib/pipeline/breadthPipeline.ts` by serializing kills/losses page fetches (kills first, then losses) instead of issuing both concurrently, and added regression coverage in `src/lib/pipeline/breadthPipeline.test.ts` to ensure losses page fetches do not start before kills page fetches settle.
- Fixed fleet-summary engagement-pill interaction semantics so non-linked `Fleet`/`Solo` combat capability pills no longer trigger row anchor-scroll behavior; `src/components/FleetSummary.tsx` now marks those pills as row-click excluded, `src/styles.css` sets a non-click cursor affordance for them, and `src/components/FleetSummary.test.tsx` adds a regression test that verifies clicking `Fleet`/`Solo` pills does not invoke row smooth-scroll.
- Added foundational `pill-evidence-links` scaffolding by introducing `src/lib/pillEvidence.ts` (strict candidate validation plus deterministic most-recent evidence selection with killmail-ID tie-break), extending `ShipPrediction` with optional `pillEvidence` metadata in `src/lib/intel.ts`, and adding focused regression coverage in `src/lib/pillEvidence.test.ts`.
- Enforced strict evidence-backed role-pill gating in `src/lib/roles.ts`: removed hull-only role display paths, selected per-role evidence via most-recent valid candidate resolution, and emitted normalized role evidence records (`pillName`, `causingModule`, `fitId`, `killmailId`, `zkillUrl`, `timestamp`) into pipeline debug output; added/updated regression coverage in `src/lib/roles.test.ts`.
- Added strict evidence-backed `Cyno`/`Bait` gating by implementing selected cyno/bait evidence extraction in `src/lib/cyno.ts` (module-derived loss evidence with deterministic most-recent selection), requiring `ship.pillEvidence` for `Cyno`/`Bait` rendering in `src/lib/presentation.ts`, and updating regression coverage in `src/lib/cyno.test.ts`, `src/lib/presentation.test.ts`, `src/lib/ui.test.tsx`, plus the app layout snapshot.
- Wired derived inference pill-evidence persistence in `src/lib/pipeline/executors.ts` by merging role and cyno/bait selected evidence into each predicted ship’s `pillEvidence` map, and now emitting one structured debug payload per displayed evidence-backed non-`Fleet`/`Solo` pill (including `pillName`, `causingModule`, `fitId`, `eventType`, `killmailId`, `zkillUrl`, `timestamp`); added regression coverage in `src/lib/pipeline/executors.recompute.test.ts`.
- Added fleet-summary click-through for evidence-backed non-`Fleet`/`Solo` alerts by introducing `icon-link` rendering in `src/lib/ui.tsx` (wrapping selected pill/module icons with their causative zKill URL) and wiring `src/components/FleetSummary.tsx` to use it; added regression coverage in `src/lib/ui.test.tsx` and `src/components/FleetSummary.test.tsx`.
- Extended evidence-link click-through to pilot-card pill surfaces by allowing `pill` mode evidence wrapping in `src/lib/ui.tsx`, so evidence-backed pills in both `Ship Summary` and `Likely Ships` now open their causative zKill kill/loss URL; added regression coverage in `src/lib/ui.test.tsx` and `src/components/PilotCardView.test.tsx`, updated layout snapshot output in `src/__snapshots__/App.layout.snapshot.test.tsx.snap`, and added link styling hooks in `src/styles.css`.
- Removed the standalone `Cyno Capable` pill from likely-ship rows in `src/components/PilotCardView.tsx`, widened the DPS capability tile by shifting `src/styles.css` ship-metrics grid columns to `1.1fr/0.9fr`, and prevented DPS damage-split percentages from wrapping by making `.damage-inline` single-line; added regression coverage in `src/components/PilotCardView.test.tsx` and updated `src/__snapshots__/App.layout.snapshot.test.tsx.snap`.
- Applied strict evidence-only rendering for non-`Fleet`/`Solo` pills across pilot-card surfaces by requiring selected evidence URLs before rendering role/cyno/bait pills in `src/lib/ui.tsx` (pill/icon/icon-link modes), and added regression coverage in `src/lib/ui.test.tsx` and `src/components/PilotCardView.test.tsx`.
- Finalized pill-evidence cache/schema invalidation safety by bumping derived inference cache keys to `derived.inference.v8` in `src/lib/pipeline/pure.ts` and snapshot compatibility namespaces to `v2` in `src/lib/pipeline/snapshotCache.ts` (`version: 2`, `eve-intel.cache.pipeline.snapshot.v2`, `snapshot-src-v2`); added regression coverage in `src/lib/pipeline/snapshotCache.test.ts` and updated versioned cache assertions in `src/lib/pipeline/pure.test.ts` and `src/lib/pipeline/breadthPipeline.test.ts`.
- Stabilized CI test behavior by hardening `src/App.paste.integration.test.tsx`: added explicit `cleanup()` after each test and changed the pilot-card assertion to wait for the rendered `Likely Ships` heading instead of matching `A9tan` text that can appear earlier in the clipboard payload textarea.
- Hardened `scripts/tests/dogma-parity-followup-cruiser-coverage.test.mjs` for clean-checkout CI runs by returning early when build-generated Dogma artifacts (`public/data/dogma-manifest.json` or referenced pack file) are absent during `npm test`.
- Fixed zKill character danger normalization for low direct-percentage values by treating `dangerRatio`/`gangRatio` values as percent when already in `0..100` range (for example, `6` now remains `6%` instead of becoming `60%`), while retaining legacy `dangerous` `0..10` compatibility; added regression coverage in `src/lib/api/zkill.test.ts`.
- Bumped the cache namespace version from `v3` to `v4` in `src/lib/cache/types.ts`, forcing cache-key invalidation for all users so stale cached zKill danger values and related cached envelopes do not persist across the scoring fix; updated cache tests in `src/lib/cache.test.ts` to assert versioned keys via `versionedKey(...)`.
- Hardened debug-log lifecycle safety in `src/lib/useDebugLog.ts` by guarding queued flushes after unmount/environment teardown, switching timer calls to `globalThis`, and clearing pending buffers/timers in cleanup; added regression coverage in `src/lib/useDebugLog.test.tsx`.
- Fixed zKill in-flight dedupe cancellation coupling in `src/lib/api/zkill.ts` by keying foreground refreshes per abort-signal identity (instead of a single shared `fg` bucket), preventing one caller’s abort from cancelling unrelated foreground callers; added regression coverage in `src/lib/api/zkill.test.ts`.
- Added explicit background-refresh failure telemetry in `src/lib/usePilotIntelPipelineEffect.ts` so page-1 revalidation errors are logged with pilot/force-network context rather than silently swallowed; added regression coverage in `src/lib/usePilotIntelPipelineEffect.test.tsx`.
- Removed dead `processPilot` plumbing from active pipeline wiring by trimming unused `runPilotPipeline` parameters and hook dependency surface in `src/lib/pipeline/runPipeline.ts` and `src/lib/usePilotIntelPipelineEffect.ts`, with corresponding test updates in `src/lib/pipeline/runPipeline.test.ts` and `src/lib/usePilotIntelPipelineEffect.test.tsx`.
- Refactored ship-specific dogma parity overrides into centralized data tables in `src/lib/dogma/calc.ts` (weapon profile overrides, defense HP overrides, resonance overrides, and reactive-armor parity overrides) to reduce scattered hardcoded conditionals; added characterization coverage in `src/lib/dogma/calc.test.ts`.
- Improved dogma hot-path lookup efficiency in `src/lib/dogma/calc.ts` by caching normalized attribute maps/effect sets and normalized-name tokens, reducing repeated normalization work in `getAttrLoose(...)` and `hasAnyEffect(...)` call sites.
- Fixed long-module EFT layout overflow in likely-ship rows by hardening `src/styles.css` grid shrink/wrap behavior (`.ship-fit-and-metrics`, `.ship-fit-and-metrics > *`, `.ship-eft`, `.ship-metrics`), so EFT and combat-capability containers retain consistent right-edge padding and alignment under long module names.
- Restricted Fleet Summary alert pills to `Fleet/Solo`, `Bait`, `Cyno`, and interdiction roles (`HIC`/`Bubble`), while keeping full pill visibility unchanged in fit details and pilot-card summary surfaces; added regression coverage in `src/components/FleetSummary.test.tsx`.
- Rebalanced Fleet Summary row layout in `src/styles.css` by widening both primary/secondary ship columns by 10% and keeping the alerts/pills column in normal left-aligned flow (no right-edge alignment override), while `src/components/FleetSummary.tsx` keeps top-two inferred ships in separate primary/secondary ship columns with empty secondary column when absent and clean ellipsis truncation for long ship names; added regression coverage in `src/components/FleetSummary.test.tsx`.
- Refined Fleet Summary grid sizing in `src/styles.css` to use shrink-safe `minmax(0, ...)` fractional tracks and a 20% wider inter-column gap (`12px`), preventing row overflow introduced by rigid width growth while keeping the two ship columns farther apart and pills in normal column flow.
- Increased Fleet Summary primary/secondary ship track weights by an additional 20% (`1.4fr -> 1.68fr` per ship column) in `src/styles.css` to use available space for predicted ships while preserving overflow-safe shrink behavior.
- Updated Fleet Summary pill-source logic in `src/components/FleetSummary.tsx` so when both top inferred ships are near coin-flip probability (`45-55%`), pills are shown from both ships; otherwise pills remain sourced from the top ship only. Added regression coverage in `src/components/FleetSummary.test.tsx`.
- Recalibrated narrow-width thresholds to avoid pre-hide overflow and premature summary wrapping: below `1060px`, only the combat capability container now hides (`.ship-metrics`) while EFT remains visible; below `770px`, the full likely-ships side container (`.ship-column`) now hides (including EFT details/combat area) with pilot cards forced to single-column, and `.player-card` now expands to fill the freed width (no `400px` cap). Fleet Summary secondary ship hides at `<=1060px`, alliance at `<=860px`, corporation at `<=770px`, and single-column Fleet Summary condensation begins at `<=480px`. Desktop `BrowserWindow` minimum width is now `500` in `electron/main.cjs`. Regression coverage added/updated in `src/components/FleetSummary.test.tsx`, `src/styles.responsiveNarrow.test.ts`, and `src/electron.windowSizing.contract.test.ts`.

Boundary source:
- Previous boundary tag `v0.2.9` (`5c24b89`) and version marker commit `ecfb03e` (`v0.3.0`) were used because no `v0.3.0` tag exists.
- Additional post-marker workspace changes are documented directly in this entry.

## v0.2.9 - 2026-02-18
- Streamlined inference evidence summarization scans by adding a shared one-pass summary path in `src/lib/intel/summaries.ts` and switching `recomputeDerivedInference` in `src/lib/pipeline/executors.ts` to derive coverage and top-evidence rows from the same pass; added regression coverage in `src/lib/pipeline/executors.recompute.test.ts`.
- Improved fit-metric resolver hot-path performance by memoizing per-fit/per-character metric-key construction in `src/lib/useFitMetrics.ts`, avoiding repeated module-sort key rebuilds on cache hits while preserving existing result semantics; added regression coverage in `src/lib/useFitMetrics.test.ts`.
- Completed Step-8 refactor hardening by rerunning required validations (`npm test`, `npm run build` last) and finalizing v0.2.9 release-note boundary coverage through `refactor(backtest): canonicalize zkill backtest tuning path`.
- Canonicalized zKill backtest tuning by adding a Step-6 canonicalization gate (`scripts/tests/backtest-zkill-canonicalization.test.mjs`), introducing shared scoring helpers in `src/lib/backtestCore.ts`, routing `src/lib/backtest.ts` through the shared core, and delegating `scripts/backtest-zkill.mjs` to shared candidate scoring + recency predictor logic.
- Canonicalized zKill rate-limit probe implementation by adding a Step-5 wrapper-shape gate (`scripts/tests/zkill-rate-limit-probe-canonicalization.test.mjs`) and converting `scripts/zkill-rate-limit-probe.mjs` into a thin CLI entrypoint that delegates parsing and probe execution to `src/lib/dev/zkillRateLimitProbe.ts`.
- Added a Step-4 dead-export hygiene gate (`scripts/tests/dogma-pipeline-dead-export-hygiene.test.mjs`) and removed scoped dead export surface by deleting `getDogmaVersion` in `src/lib/dogma/loader.ts`, deleting `getAttr` in `src/lib/dogma/index.ts`, and making `buildPilotSnapshotKey` internal in `src/lib/pipeline/snapshotCache.ts`.
- Added a Step-3 duplicate-import hygiene gate (`scripts/tests/pipeline-duplicate-import-hygiene.test.mjs`) and consolidated duplicate module imports in `src/lib/usePilotIntelPipelineEffect.ts`, `src/lib/pipeline/executors.ts`, `src/lib/pipeline/derivedInference.ts`, and `src/lib/pipeline/inferenceWindow.ts` without changing behavior.
- Added a Step-2 unused-symbol hygiene gate (`scripts/tests/pipeline-unused-symbol-hygiene.test.mjs`) and removed stale imports in `src/App.paste.integration.test.tsx` and `src/lib/pipeline/breadthPipeline.ts`, while consolidating `derivedInference` cache test stubs into a single typed helper for deterministic, low-noise coverage.
- Added a repository artifact-hygiene gate (`scripts/tests/repository-artifact-hygiene.test.mjs`), removed tracked `scripts/__pycache__/*.pyc` bytecode artifacts, and added a narrow `.gitignore` rule for `scripts/__pycache__/`.
- Added a Dogma engine type-export hygiene gate (`scripts/tests/dogma-engine-type-export-hygiene.test.mjs`) and removed unused exported types (`EngineContext`, `OffenseStageInput`, `DefenseStageInput`) from `src/lib/dogma/engine/types.ts`, retaining only the actively consumed `EngineTrace` export.
- Switched Triglavian disintegrator offense modeling to always use module maximum spool multipliers for displayed DPS (instead of base-cycle disintegrator DPS), and added regression coverage for synthetic disintegrator max-spool math plus updated Nergal envelope assertions.
- Completed full T3 cruiser subsystem parity coverage by adding pyfa-referenced manual fits for previously uncovered Legion/Loki/Proteus/Tengu subsystem variants, adding a strict coverage test that requires every category-32 T3 subsystem to appear in referenced corpus fits, and fixing missing Amarr/Gallente defensive armor-HP subsystem multiplier handling that caused EHP underreporting on augmented-plating profiles.
- Fixed Tengu offensive-subsystem kinetic missile parity by handling `subsystemBonusCaldariOffensive2MissileLauncherKineticDamage` in Dogma, and closed the regression coverage gap by adding a pyfa-referenced kinetic HAM Tengu fit (`manual-tengu-paomo1-kinetic-ham-1`) to corpus, golden IDs, and strict cruiser follow-up checks.
- Fixed inferred-fit construction for strategic cruisers by including fitted subsystem flags (`125-132`), so in-app Dogma simulation receives subsystem modules in `other` slots and no longer underreports T3 offensive output from missing subsystem effects.
- Improved inferred EFT rendering for T3 cruisers by labeling their `other` section as `Subsystems:` (while retaining `Other:` for non-T3 fits), matching expected strategic cruiser EFT presentation.
- Fixed inferred fit script pairing for missile-guidance mids by treating `Missile Guidance ...` modules as non-charge modules, preventing standalone `Missile Range Script` lines from replacing `Missile Guidance Computer` entries.
- Fixed inferred fit pairing for legacy weapon-module names (`... Missile Bay`, `... Rocket Bay`, and `... 'Probe' Artillery ...`) so their ammo rows no longer replace the fitted module entry when loss item order is charge-first.
- Fixed T3 defensive/speed parity for subsystem-heavy fits by applying fitted subsystem additive HP bonuses in defense evaluation, removing stale hardcoded Loki/Proteus HP uplifts, and using prop thrust-to-mass scaling (with `Mass` from `invTypes`) for active speed so Tengu-style AB fits now align with pyfa `EHP` and max-speed baselines.
- Completed T3 destroyer follow-up gate closure by adding 58 curated zKill destroyer corpus/reference fits (Hecate/Jackdaw/Confessor/Svipul at 15 each), introducing destroyer coverage + strict gate regression tests, and aligning tactical destroyer defensive resist assumptions by hull family so all destroyer hulls now meet `>=10` passing fits under the follow-up `10%` surfaced-metric rule.
- Aligned Reactive Armor Hardener parity with pyfa equilibrium behavior (cycle-based redistribution + deterministic average profile), and closed residual Legion/Proteus T3 cruiser gate deficits to `10/10` passing fits each under follow-up `10%` surfaced-metric rules.
- Added T3 cruiser mechanic-cluster parity fixes for polarized resistance-killer effects, civilian turret skill scaling, Caldari defensive subsystem shield-HP bonuses, and Reactive Armor Hardener profile handling, with new cruiser regression tests for strict 10% surfaced-metric checks.
- Expanded T3 cruiser parity coverage with 35 curated zKill-based Loki/Legion/Proteus/Tengu fits, synced pyfa reference rows for each new fit, and added a regression coverage test enforcing `>=10` corpus+reference fits per cruiser hull.
- Added deterministic follow-up prioritization backlog generation for mismatch mechanic clusters (`damage-output`, `effective-hit-points`, `resist-profile`), including stable ordering and per-cluster score breakdowns (`errorSeverity`, `hullGatePressure`, `mechanicReuse`, `fitPrevalence`).
- Added a follow-up fit/hull gate evaluator for `followup-10pct` parity semantics, including per-fit pass/fail classification, T3 cruiser and T3 destroyer per-hull deficits, and phase sequencing that blocks destroyer completion until cruisers are complete.
- Added deterministic follow-up baseline summary artifact generation (`reports/dogma-parity-followup-baseline-summary.json`) with strict `followup-10pct` threshold policy metadata, per-fit max-relative-delta rollups, per-hull pass/deficit counts, and ranked mismatch output.
- Wired follow-up baseline CLI to run the default baseline artifact pipeline with configurable `--parity-report-path` and `--summary-path` inputs, plus regression coverage for end-to-end summary emission.
- Added follow-up baseline CLI scaffolding with an explicit precondition entry gate (`dogma:parity:followup:baseline`) that exits before baseline generation unless the prerequisite task is marked complete.
- Added deterministic new-fit scope helpers for scoped Dogma parity workflows, including scope-file loading and manual fit-id normalization with regression tests.
- Added scoped Dogma parity comparison helpers that evaluate only selected new-fit IDs, with deterministic ordering and explicit missing-corpus/reference reporting tests.
- Added scoped pyfa reference sync helpers that process only selected new-fit IDs, deterministically merge references by `fitId`, and continue through missing-corpus/pyfa-failure cases with regression tests.
- Added a new-fit parity orchestrator CLI module and import-safe entrypoint that composes scoped scope/sync/compare flows with explicit usage/fatal handling and non-zero-on-mismatch exit policy tests.
- Added deterministic new-fit parity report + optional diagnostics artifact writing (`reports/dogma-parity-new-fits-report.json` + JSONL events), and wired orchestrator emission with regression coverage.
- Added first-class `dogma:parity:new-fits` npm script wiring and new-fit CLI argument-contract tests covering `--scope-file`/`--fit-id(s)` ergonomics and usage errors.
- Added scoped compare guardrails that continue through per-fit Dogma parse/compute failures and emit structured diagnostics error events instead of aborting the full new-fit run.
- Aligned scoped new-fit diagnostics with explicit blocker semantics by adding deterministic `blockedFitCount`/`blockedFitIds`/`blockedFits` report fields and making blocker-only scoped runs exit non-zero with blocker counts in CLI summaries.
- Added an end-to-end zKill fit-fetch CLI (`npm run zkill:fits:fetch`) with strict argument validation and default `--max-records 200`.
- Added deterministic ship-type pagination/merge ordering, strict `--before-killmail-id` cutoff behavior, and max-record short-circuiting.
- Added header-aware retry/backoff (`Retry-After` and rate-limit headers first, exponential fallback second) with timeout-aware retry handling.
- Added fit normalization that includes both destroyed and dropped fitted modules with deterministic slot-family mapping.
- Added deterministic dedupe by primary `killmailId` and secondary canonical `fitHash`, preserving keep-first stream order.
- Added deterministic artifact outputs: fit-record JSONL, structured-error JSONL, and manifest JSON with counts and `nextBeforeKillmailId`.
- Added a dedicated zKill CLI orchestration module plus import-safe script entrypoint wiring, with regression coverage for help/usage/success/fatal exit behavior.
- Added unit and integration regression coverage across args, pagination, retry, normalization, dedupe, artifacts, and full pipeline orchestration.
- Improved zKill cache refresh/revalidation behavior and UI reliability (explicit-ship refresh correctness, reduced background flicker, and unknown-fit role-pill handling fixes).

Boundary source:
- Previous version marker commit `96a7691` (`v0.2.8`) used as lower boundary because no `v0.2.9` tag exists yet.
- Summarized from history in range `96a7691..6e384db`.

## v0.2.8 - 2026-02-18
- Added a major combat-capability parity workflow: fit corpus data, reference sync scripts, pyfa adapter tooling, and parity reporting artifacts.
- Expanded Dogma and pipeline architecture with staged processing modules, caching/snapshot behavior, and broader test coverage across API, UI, and pipeline layers.
- Refactored UI composition into focused components and hook-based logic, including app preferences, debug controls, and desktop bridge integration.
- Improved zKill/ESI handling and added rate-limit/cache-policy test coverage.
- Added CI workflow and supporting reliability-focused test suites.

Boundary source:
- Version marker commit `96a7691` (`v0.2.8`) used as release boundary because no `v0.2.8` tag exists.
- Summarized from history in range `b38004c..96a7691`.

## v0.2.7 - 2026-02-16
- Updated ship probability behavior to account for kills and losses.
- Extended intel and zKill logic/tests for probability-related behavior.

Boundary source:
- Version marker commit `b38004c` (`Version 0.2.7...`) used as release boundary.
- `v0.2.7` tag currently points to `bf1a3d4` (same as `v0.2.6`), so commit message boundary was used.
- Summarized from history in range `bf1a3d4..b38004c`.

## v0.2.6 - 2026-02-16
- Added ISK send capability and related desktop integration updates.
- Updated release/publish scripting and UI styling around the new behavior.

Boundary source:
- Tagged commit `bf1a3d4` (`v0.2.6`).
- Summarized from history in range `a404ce8..bf1a3d4`.

## v0.2.5 - 2026-02-15
- Added auto-update and desktop preload/main bridge updates.
- Applied visual/UI refresh updates across the app.

Boundary source:
- Tagged commit `a404ce8` (`v0.2.5`).
- Summarized from history in range `ead5744..a404ce8`.

## v0.2.4 - 2026-02-15
- Updated Electron main process behavior and corresponding UI layout/snapshot output.
- Applied incremental app styling updates.

Boundary source:
- Tagged commit `ead5744` (`v0.2.4`).
- Summarized from history in range `5b0381f..ead5744`.

## v0.2.3 - 2026-02-15
- Improved parsing and intel processing behavior with test updates.
- Updated app UI and styling refinements.
- Updated release automation script and package metadata.

Boundary source:
- Version marker commit `5b0381f` (`Version 0.2.3`) used as release boundary.
- `v0.2.3` tag currently points to `b216dbf` (same as `v0.2.2`), so commit message boundary was used.
- Summarized from history in range `b216dbf..5b0381f`.

## v0.2.2 - 2026-02-15
- Initial project release.
- Added Electron + Vite app shell, UI, parser/intel/backtest/cyno/roles modules, and API integrations (ESI/zKill).
- Added test suite baseline across app layout/integration and core libraries.
- Added desktop wrapper docs, release script, and project build configuration.

Boundary source:
- Tagged commit `b216dbf` (`v0.2.2`).
